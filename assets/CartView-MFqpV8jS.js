import{_ as w,g as V,h as x,c as a,b as n,a as e,F as f,e as U,t as d,f as g,i as b,v as h,w as T,r as m,o as i,d as r,n as p}from"./index-1h0Yfx-J.js";import{c as v}from"./cartStore-uNdY7Xfk.js";import{s as $}from"./swalMixin-fJjGCbAJ.js";function q(t,o=500){this.debounceTimer!=null&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.debounceTimer=setTimeout(()=>{t.call(this)},o)}const F={data(){return{isLoading:!1}},computed:{...V(v,["cartList","orderInfo","temp","currentLoadingId"])},watch:{orderInfo:{handler(t){t.user.email||this.$refs.form.resetForm()},deep:!0}},methods:{...x(v,["getCartList","putCartItem","deleteCartItem","deleteCartAll","postOrder","applyCoupon"]),debounce:q},async mounted(){this.isLoading=!0,await this.getCartList(),this.isLoading=!1},mixins:[$]},I={class:"container"},N={class:"mt-4 row"},z={class:"text-end mb-3"},S=["disabled"],A=e("span",{style:{"font-size":"14px","font-weight":"600"}},"清空購物車",-1),B=[A],E={class:"table align-middle",style:{"--bs-table-bg":"transparent","--bs-table-border-color":"#5762874a"}},D=e("thead",null,[e("tr",null,[e("th",{style:{width:"200px"}}),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價"),e("th",null,"小計")])],-1),M=["onClick","disabled"],O=e("span",{class:"material-symbols-outlined"}," close ",-1),j=[O],G=["src","alt"],H={key:0,class:"text-success"},J={class:"input-group input-group-sm"},K={class:"input-group"},P=["onUpdate:modelValue","onInput"],Q={class:"input-group-text",id:"basic-addon2"},R={class:"text-end"},W={class:"text-end"},X={key:0,class:"mb-0"},Y={class:"text-decoration-line-through"},Z=e("br",null,null,-1),ee={class:"text-success"},te={key:1},se=e("td",{colspan:"5"},[e("p",{class:"text-center my-5"},"購物車目前沒有商品")],-1),oe=[se],le=e("td",{colspan:"4",class:"text-end"},"總計",-1),ne={class:"text-end"},ae={key:0},de=e("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),ie={class:"text-end text-success"},re={class:"input-group mb-3 d-flex"},ce=["disabled"],ue=e("span",{class:"text-primary-dark",style:{"font-size":"14px","font-weight":"600"}},"套用優惠券",-1),me=[ue],pe={class:"my-5 row justify-content-center"},fe={class:"mb-3"},be=e("label",{for:"email",class:"form-label"},[r("Email "),e("span",{class:"text-danger"},"*")],-1),he={class:"mb-3"},_e=e("label",{for:"name",class:"form-label"},[r("收件人姓名 "),e("span",{class:"text-danger"},"*")],-1),ye={class:"mb-3"},ge=e("label",{for:"tel",class:"form-label"},[r("收件人電話 "),e("span",{class:"text-danger"},"*")],-1),ve={class:"mb-3"},Ce=e("label",{for:"address",class:"form-label"},[r("收件人地址 "),e("span",{class:"text-danger"},"*")],-1),Le={class:"mb-3"},ke=e("label",{for:"message",class:"form-label"},"留言",-1),we=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary text-white"},[e("span",{class:"text-primary-dark",style:{"font-size":"14px","font-weight":"600"}},"送出訂單")])],-1);function Ve(t,o,xe,Ue,_,C){var y;const L=m("Loading"),c=m("v-field"),u=m("error-message"),k=m("v-form");return i(),a(f,null,[n(L,{active:_.isLoading,"onUpdate:active":o[0]||(o[0]=s=>_.isLoading=s)},null,8,["active"]),e("div",I,[e("div",N,[e("div",z,[e("button",{class:"btn border-1 border-dark border-opacity-50",type:"button",onClick:o[1]||(o[1]=s=>t.showCheck({fn:()=>t.deleteCartAll(),title:"清空購物車",text:"清空後將無法復原"})),disabled:!t.cartList.carts||t.cartList.carts.length<=0},B,8,S)]),e("table",E,[D,e("tbody",null,[((y=t.cartList.carts)==null?void 0:y.length)>0?(i(!0),a(f,{key:0},U(t.cartList.carts,s=>(i(),a("tr",{key:s.id},[e("td",null,[e("button",{type:"button",class:"btn",onClick:l=>t.showCheck({fn:()=>t.deleteCartItem(s.id),title:"刪除商品",text:"刪除後將無法復原"}),disabled:t.currentLoadingId===s.id},j,8,M),e("img",{src:s.product.imageUrl,alt:s.product.title,style:{"max-width":"100px"}},null,8,G)]),e("td",null,[r(d(s.product.title)+" ",1),t.cartList.total!==t.cartList.final_total?(i(),a("div",H," 已套用優惠券 ")):g("",!0)]),e("td",null,[e("div",J,[e("div",K,[b(e("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":l=>s.qty=l,onInput:l=>C.debounce(()=>t.putCartItem(s.id,s.product_id,s.qty))},null,40,P),[[h,s.qty,void 0,{number:!0}]]),e("span",Q,d(s.product.unit),1)])])]),e("td",R,d(s.product.price),1),e("td",W,[t.cartList.total===t.cartList.final_total?(i(),a("p",X,d(s.total),1)):(i(),a(f,{key:1},[e("span",Y,d(s.total),1),Z,e("small",ee,"折扣價："+d(s.final_total.toFixed(0)),1)],64))])]))),128)):(i(),a("tr",te,oe))]),e("tfoot",null,[e("tr",null,[le,e("td",ne,"NT "+d(t.cartList.total),1)]),t.cartList.total!==t.cartList.final_total?(i(),a("tr",ae,[de,e("td",ie,d(t.cartList.final_total.toFixed(0)),1)])):g("",!0)])]),e("div",re,[b(e("input",{type:"text",class:"form-control ms-auto",style:{"max-width":"300px"},placeholder:"請輸入優惠碼","aria-label":"請輸入優惠碼","aria-describedby":"button-addon2","onUpdate:modelValue":o[2]||(o[2]=s=>t.temp.couponCode=s)},null,512),[[h,t.temp.couponCode]]),e("button",{class:"btn btn-primary",type:"button",id:"button-addon2",onClick:o[3]||(o[3]=s=>t.applyCoupon(t.temp.couponCode)),disabled:!t.temp.couponCode},me,8,ce)])]),e("div",pe,[n(k,{ref:"form",class:"col-md-6",onSubmit:o[9]||(o[9]=s=>t.showCheck({fn:()=>t.postOrder(),title:"送出訂單",text:"請確認訂單內容是否正確"}))},{default:T(({errors:s})=>[e("div",fe,[be,n(c,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:t.orderInfo.user.email,"onUpdate:modelValue":o[4]||(o[4]=l=>t.orderInfo.user.email=l)},null,8,["class","modelValue"]),n(u,{name:"email",class:"invalid-feedback"})]),e("div",he,[_e,n(c,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.orderInfo.user.name,"onUpdate:modelValue":o[5]||(o[5]=l=>t.orderInfo.user.name=l)},null,8,["class","modelValue"]),n(u,{name:"姓名",class:"invalid-feedback"})]),e("div",ye,[ge,n(c,{id:"tel",name:"電話",type:"text",class:p(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:{required:!0,regex:/^09\d{2}-?\d{3}-?\d{3}$/},modelValue:t.orderInfo.user.tel,"onUpdate:modelValue":o[6]||(o[6]=l=>t.orderInfo.user.tel=l)},null,8,["class","modelValue"]),n(u,{name:"電話",class:"invalid-feedback"})]),e("div",ve,[Ce,n(c,{id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.orderInfo.user.address,"onUpdate:modelValue":o[7]||(o[7]=l=>t.orderInfo.user.address=l)},null,8,["class","modelValue"]),n(u,{name:"地址",class:"invalid-feedback"})]),e("div",Le,[ke,b(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[8]||(o[8]=l=>t.orderInfo.message=l)},null,512),[[h,t.orderInfo.message]])]),we]),_:1},512)])])],64)}const Fe=w(F,[["render",Ve]]);export{Fe as default};
